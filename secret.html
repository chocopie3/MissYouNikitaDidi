<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Secret Gift üóùÔ∏è</title>
  <link rel="stylesheet" href="assets/style.css">
  <style>
    body {
      min-height: 100vh;
      margin: 0;
      font-family: 'Segoe UI', 'Arial', sans-serif;
      background: #111;
      overflow: hidden;
      position: relative;
    }
    .secret-bg {
      position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; z-index: 0;
      background: radial-gradient(ellipse at 60% 40%, #23234a 0%, #18182c 60%, #111 100%);
      animation: secretShift 12s infinite alternate;
    }
    @keyframes secretShift {
      0% { background: radial-gradient(ellipse at 60% 40%, #23234a 0%, #18182c 60%, #111 100%);}
      100% { background: radial-gradient(ellipse at 40% 60%, #2a1a3d 0%, #23234a 60%, #111 100%);}
    }
    .secret-container {
      display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh;
      position: relative; z-index: 2;
    }
    .lock-area {
      position: relative; width: 120px; height: 160px; margin-bottom: 32px;
      display: flex; align-items: center; justify-content: center;
    }
    .lock-icon {
      position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
      width: 80px; height: 120px;
      filter: drop-shadow(0 0 18px #b57edc88);
      cursor: pointer;
      transition: filter 0.5s;
      animation: pulseLock 2.5s infinite;
    }
    @keyframes pulseLock {
      0% { filter: drop-shadow(0 0 18px #b57edc88);}
      50% { filter: drop-shadow(0 0 32px #b57edc);}
      100% { filter: drop-shadow(0 0 18px #b57edc88);}
    }
    .lock-icon.unlocked {
      animation: none;
      filter: drop-shadow(0 0 32px #fff);
    }
    .particles {
      position: absolute; left: 0; top: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;
    }
    .secret-message {
      font-size: 1.18em; color: #e7d6ff; text-align: center; max-width: 420px;
      margin: 0 auto; opacity: 0; transition: opacity 1.5s;
      font-weight: 500; text-shadow: 0 2px 12px #23234a;
      margin-bottom: 18px;
      white-space: pre-wrap; /* preserve newlines in JS text */
    }
    .secret-message.active {
      opacity: 1;
      animation: fadeInMsg 2.5s;
    }
    @keyframes fadeInMsg {
      0% { opacity: 0;}
      100% { opacity: 1;}
    }
    .secret-note {
      font-size: 1.08em; color: #b57edc; text-align: center; margin-top: 18px; opacity: 0; transition: opacity 1.5s;
      font-weight: 500; text-shadow: 0 2px 12px #23234a;
    }
    .secret-note.active {
      opacity: 1;
      animation: fadeInMsg 2.5s;
    }
    .infinity {
      margin: 32px auto 0 auto; text-align: center; opacity: 0; transition: opacity 2s;
      animation: infinityPulse 3s infinite;
      font-size: 2.5em; color: #b57edc; text-shadow: 0 0 18px #fff6;
    }
    .infinity.active {
      opacity: 1;
    }
    @keyframes infinityPulse {
      0% { filter: brightness(1.2);}
      50% { filter: brightness(1.5);}
      100% { filter: brightness(1.2);}
    }
    /* make restart button visible and usable */
    .restart-btn {
      position: absolute; bottom: 32px; left: 50%; transform: translateX(-50%);
      opacity: 0.9; transition: opacity 0.25s;
      font-size: 1em; color: #fff; background: #23234a; border: none; border-radius: 18px;
      padding: 8px 24px; cursor: pointer; z-index: 10;
      box-shadow: 0 2px 8px #b57edc44;
    }
    .restart-btn:hover { opacity: 1; }
  </style>
</head>
<body>
  <div class="secret-bg"></div>
  <div class="secret-container">
    <div class="lock-area">
      <svg class="lock-icon" id="lockIcon" viewBox="0 0 80 120" role="button" tabindex="0" aria-label="Unlock secret">
        <rect x="20" y="60" width="40" height="50" rx="12" fill="#23234a" stroke="#b57edc" stroke-width="4"/>
        <ellipse cx="40" cy="60" rx="20" ry="22" fill="#18182c" stroke="#b57edc" stroke-width="4"/>
        <rect x="34" y="85" width="12" height="18" rx="6" fill="#b57edc"/>
        <circle cx="40" cy="94" r="4" fill="#fff"/>
      </svg>
      <canvas class="particles" id="particles"></canvas>
    </div>
    <div class="secret-message" id="secretMsg"></div>
    <div class="secret-note" id="secretNote"></div>
    <div class="infinity" id="infinity">&#8734;</div>
    <button class="restart-btn" id="restartBtn" title="Restart Giftbox">Restart Giftbox</button>
  </div>
  <audio id="secretAudio" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12b7b8b7b7.mp3" loop></audio>
  <audio id="chimeAudio" src="https://cdn.pixabay.com/audio/2022/03/15/audio_3c2e3d7a7e.mp3"></audio>
  <script>
    // Particle fireflies
    const canvas = document.getElementById('particles');
    const ctx = canvas.getContext('2d');
    function resizeCanvas() {
      const dpr = window.devicePixelRatio || 1;
      // size the canvas to its displayed size for crisp drawing
      const w = canvas.clientWidth || 120;
      const h = canvas.clientHeight || 160;
      canvas.width = Math.max(1, Math.floor(w * dpr));
      canvas.height = Math.max(1, Math.floor(h * dpr));
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    let particles = [];
    function spawnParticle() {
      particles.push({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height,
        r: Math.random()*2+1,
        vx: (Math.random()-0.5)*0.3,
        vy: (Math.random()-0.5)*0.3,
        alpha: 0.7+Math.random()*0.3,
        color: `hsl(${Math.random()*280+180},60%,70%)`
      });
    }
    // seed a few particles immediately so the canvas is not empty on load
    for (let i=0;i<6;i++) spawnParticle();
    function drawParticles() {
      // clear using device pixels already set via setTransform
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for (let p of particles) {
        ctx.globalAlpha = p.alpha;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, 2*Math.PI);
        ctx.fillStyle = p.color;
        ctx.fill();
        p.x += p.vx;
        p.y += p.vy;
        if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
        if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
      }
      if (particles.length < 24 && Math.random() < 0.25) spawnParticle();
      requestAnimationFrame(drawParticles);
    }
    drawParticles();

    // Lock unlock logic
    const lockIcon = document.getElementById('lockIcon');
    const secretMsg = document.getElementById('secretMsg');
    const secretNote = document.getElementById('secretNote');
    const infinity = document.getElementById('infinity');
    const restartBtn = document.getElementById('restartBtn');
    let unlocked = false;

    lockIcon.addEventListener('mousemove', e => {
      // Subtle glow on mouse movement
      lockIcon.style.filter = "drop-shadow(0 0 32px #fff)";
    });
    lockIcon.addEventListener('mouseleave', e => {
      lockIcon.style.filter = "";
    });

    // accessible unlock handler (click or Enter)
    function doUnlock(){
      if (unlocked) return;
      unlocked = true;
      lockIcon.classList.add('unlocked');
      // ensure both chime and ambient try to play (user gesture)
      const ch = document.getElementById('chimeAudio');
      const s = document.getElementById('secretAudio');
      try { ch.currentTime = 0; ch.play().catch(()=>{}); } catch(e){}
      try { s.volume = 0.5; s.play().catch(()=>{}); } catch(e){}
      setTimeout(() => {
        secretMsg.textContent = "Not everything you get for your farewell can be wrapped and given in person.\nSome things are just‚Ä¶ made for you to find.\nWE LOVE YOU DIDI!!!‚ú®";
        secretMsg.classList.add('active');
      }, 700);
      setTimeout(() => {
        secretNote.textContent = "This is your reminder that you don‚Äôt need to have everything figured out.\nYou‚Äôre already doing fine ‚Äî even if you don‚Äôt see it yet. We are always there for you, deep in your heart no matter how far you go! ‚ù§Ô∏è";
        secretNote.classList.add('active');
      }, 2600);
      setTimeout(() => {
        infinity.classList.add('active');
      }, 4600);
      setTimeout(() => {
        document.title = "All gifts unlocked üéÅ";
      }, 5400);
    }
    lockIcon.addEventListener('click', doUnlock);
    lockIcon.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); doUnlock(); } });

    // Piano note heartbeat
    setInterval(() => {
      document.getElementById('secretAudio').volume = 0.5;
      document.getElementById('secretAudio').play().catch(()=>{});
    }, 4000);

    // Hidden restart button
    restartBtn.onclick = () => {
      window.location.href = "index.html";
    };
  </script>
</body>
</html>
